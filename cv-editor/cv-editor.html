<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-input/paper-textarea.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../image-mask/image-mask.html">
<link rel="import" href="../file-input/file-input.html">

<!--
`cv-editor`
CV Editor

@demo demo/index.html
-->

<dom-module id="cv-editor">

  <template>
    <style>
      :host {
        display: block;
      }

      .card-group {
        margin-t  op: -20px;
      }

      .card-group paper-card {
        margin-top: 20px;
      }

      .card-actions {
        text-align: right;
      }
      
      .card-content {
        text-aligh: left;
        width: 50%;
      }

      paper-card {
        width:100%;
      }

      paper-button.add {
        margin-top: 10px;
      }

      paper-card.horizontal { @apply(--layout-horizontal); }

    </style>
    <h2>Personal Details</h2>
    <paper-card class="horizontal">
      <div class="card-content">
        <paper-input label="Given name" value="{{data.basics.givenName}}"></paper-input>
        <paper-input label="Family name" value="{{data.basics.familyName}}"></paper-input>
        <paper-input label="Label" value="{{data.basics.label}}"></paper-input>
        <paper-input label="Start" value="{{data.basics.startYear}}"></paper-input>
      </div>
      <div class="card-content">
        <image-mask id="photoImage" src="/images/erik_bakker_square_small.jpg" size="200" on-tap="updatePhoto"></image-mask>
        <paper-button>
          <file-input id="photoInput" accept="image/*,video/*" max-files="1" on-change="photoSelected">
             Select Photo
          </file-input>
          </paper-button>
        <paper-button hidden$=[[!photoChanged]] on-tap="resetPhoto">Reset Photo</paper-button>
      </div>
    </paper-card>
    <paper-card>
      <div class="card-content" style="margin: 0 auto;">
        <paper-textarea label="Summary" value="{{data.basics.profile}}"></paper-textarea>
      </div>
    </paper-card>

    <paper-card class="horizontal">
      <div class="card-content">
        <paper-input label="Name" value="{{data.basics.contact.name}}"></paper-input>
        <paper-input label="Address" value="{{data.basics.contact.address}}"></paper-input>
        <paper-input label="Postal Code" value="{{data.basics.contact.postalCode}}"></paper-input>
        <paper-input label="City" value="{{data.basics.contact.city}}"></paper-input>
      </div>
      <div class="card-content">
        <paper-input label="Phone" value="{{data.basics.contact.phone}}"></paper-input>
        <paper-input label="Email" value="{{data.basics.contact.email}}"></paper-input>
        <paper-input label="Country Code" value="{{data.basics.contact.countryCode}}"></paper-input>
      </div>
    </paper-card>

    <h2>Education</h2>
    <div class="card-group">
    <template is="dom-repeat" items="{{data.educations}}">
      <paper-card class="horizontal">
        <div class="card-content">
          <paper-input label="Institution" value="{{item.institution}}"></paper-input>
          <paper-input label="Area" value="{{item.area}}"></paper-input>
          <paper-input label="Start Date" value="{{item.startDate}}"></paper-input>
          <paper-textarea label="Description" value="{{item.description}}"></paper-textarea>
        </div>
        <div class="card-content">
          <paper-input label="Country" value="{{item.country}}"></paper-input>
          <paper-input label="Study Type" value="{{item.studyType}}"></paper-input>
          <paper-input label="End Date" value="{{item.endDate}}"></paper-input>
        </div>
        <div class="card-actions">
          <paper-icon-button icon="delete" on-click="removeEducation"></paper-icon-button>
        </div>
      </paper-card>
    </template>
    </div class="card-group">
    <paper-button class="add" raised class="primary" on-click="addEducation"><iron-icon icon="add-circle"></iron-icon>Add education</paper-button>

    <h2>Projects</h2>
    <div class="card-group">
    <template is="dom-repeat" items="{{data.projects}}">
      <paper-card class="horizontal">
        <div class="card-content">
          <paper-input label="Client" value="{{item.client}}"></paper-input>
          <paper-input label="Start Date" value="{{item.startDate}}"></paper-input>
          <paper-textarea label="Summary" value="{{item.summary}}" ></paper-textarea>
        </div>
        <div class="card-content">
          <paper-input label="Role" value="{{item.role}}"></paper-input> 
          <paper-input label="End Date" value="{{item.endDate}}"></paper-input>
        </div>
        <div class="card-actions">
          <paper-icon-button icon="delete" on-click="removeProject"></paper-icon-button>
        </div>
      </paper-card>
    </template>
    </div class="card-group">
    <paper-button class="add" raised class="primary" on-click="addProject"><iron-icon icon="add-circle"></iron-icon>Add project</paper-button>

    <h2>Skills</h2>
    <div class="card-group">
    <template is="dom-repeat" items="{{data.skills}}">
      <paper-card class="horizontal">
        <div class="card-content">
          <paper-input label="Name" value="{{item.name}}"></paper-input>
        </div>
        <div class="card-content">
          <paper-input label="Category" value="{{item.category}}"></paper-input>
        </div>
        <div class="card-content">
          <paper-input label="Level" value="{{item.level}}"></paper-input>
        </div>
        <div class="card-actions">
          <paper-icon-button icon="delete" on-click="removeSkill"></paper-icon-button>
        </div>
      </paper-card>
    </template>
    </div class="card-group">
    <paper-button class="add" raised class="primary" on-click="addSkill"><iron-icon icon="add-circle"></iron-icon>Add skill</paper-button>

    <h2>Achievements</h2>
    <div class="card-group">
    <template is="dom-repeat" items="{{data.achievements}}">
      <paper-card>
        <div class="card-content">
          <paper-textarea label="Achievement" value="{{item}}"></paper-textarea>
        </div>
        <div class="card-actions">
          <paper-icon-button icon="delete" on-click="removeAchievement"></paper-icon-button>
        </div>
      </paper-card>
    </template>
    </div class="card-group">
    <paper-button class="add" raised class="primary" on-click="addAchievement"><iron-icon icon="add-circle"></iron-icon>Add achievement</paper-button>
  </template>

  <script>

    Polymer({

      is: 'cv-editor',

      properties: {
        data: {
          type: Object,
        },

        photoChanged: {
          type: Boolean,
          value: false
        }
      },

      ready: function() {
        if(this.data.basics === undefined) {
          this.set('data.basics', {});
        }

        if(this.data.education === undefined ){
          this.set('data.education', []);
        }
      },

      addEducation: function() {

        this.push('data.educations', { 'foo': 'bar' });
      },

      removeEducation: function(e) {
        this.splice('data.educations', e.model.index, 1);
      },

      addProject: function() {

        this.push('data.projects', { 'foo': 'bar' });
      },

      removeProject: function(e) {
        this.splice('data.projects', e.model.index, 1);
      },

      addSkill: function() {

        this.push('data.skills', { 'foo': 'bar' });
      },

      removeSkill: function(e) {
        this.splice('data.skills', e.model.index, 1);
      },

      addAchievement: function() {

        this.push('data.achievements', { 'foo': 'bar' });
      },

      removeAchievement: function(e) {
        this.splice('data.achievements', e.model.index, 1);
      },

      show: function() {
        console.log(this.data);
      },

      updatePhoto: function() {
        console.log("Update photo");
      },

      resetPhoto: function() {
        this.$.photoImage.src = this.$.photoImage.savedSrc;
        this.photoChanged = false;
      },

      photoSelected: function() {
        console.log("Photo selected!");
        console.log(this.$.photoInput.files.length);

        var reader = new FileReader();
        var photoImage = this.$.photoImage;

        if(photoImage.savedSrc == undefined) {
          photoImage.savedSrc = photoImage.src
        }

        reader.onload = function (e) {
            photoImage.src = e.target.result;
        }

        this.photoChanged = true;

        reader.readAsDataURL(this.$.photoInput.files[0]);
      }

    });
  </script>
</dom-module>
